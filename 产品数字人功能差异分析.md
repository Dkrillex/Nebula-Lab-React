# 产品数字人功能差异分析

## 概述
本文档详细对比了Vue系统(旧系统)和React系统(新系统)中"数字人视频-产品数字人"功能的实现差异。

---

## 一、功能模块对比

### 1.1 主页面功能

#### Vue系统 (`views/tv/product-avatar/components/pa-index.vue`)
✅ **已实现的功能:**
- 数字人模板选择(分类筛选、分页加载)
- 自定义数字人上传
- 人脸替换上传
- 产品图片上传
- **两种生成模式:**
  - **自动模式(normal)**: 使用AI提示词和产品尺寸滑块
  - **手动模式(highPrecision)**: 支持Canvas画布操作
- 产品尺寸滑块(1-6, 对应TINY/SMALL/MEDIUM/LARGE/X_LARGE/XX_LARGE)
- AI提示词编辑(最大2000字符)
- 自动显示开关
- 背景去除功能(手动模式下)
- 任务提交和轮询查询
- 试用示例功能

#### React系统 (`pages/Create/components/DigitalHumanProduct.tsx`)
✅ **已实现的功能:**
- 数字人模板选择(分类筛选、滚动加载)
- 自定义数字人上传
- 人脸替换上传
- 产品图片上传
- **仅支持自动模式** (缺少手动模式)
- 产品尺寸滑块(1-6)
- AI提示词编辑
- 自动显示开关
- 任务提交和轮询查询
- 试用示例功能
- 结果展示(单张图片)
- 下载功能
- 添加到素材库功能

❌ **React系统缺失的功能:**
1. **手动模式(highPrecision模式)**
   - Canvas画布操作(拖拽、旋转、缩放产品图片)
   - 产品位置精确控制
   - 背景去除功能
   - 重置图片位置功能
   - 操作提示说明

---

### 1.2 结果展示页面

#### Vue系统 (`views/tv/product-avatar/product-replace.vue`)
✅ **已实现的功能:**
- **多版本图片结果展示** (支持多个生成结果)
- **图片转视频功能(image2Video)**
  - 支持文本转语音(TTS)
  - 支持音频上传
  - 音色选择
  - 字幕样式选择
  - 数字人模式选择(avatar1/avatar2)
  - 视频生成和预览
- 图片预览功能
- 重新生成功能
- 下载功能
- 添加到素材库功能
- 任务状态轮询
- 进度条显示

#### React系统
❌ **完全缺失结果展示页面**
- 没有独立的结果展示页面
- 结果在主页面中简单展示
- **缺少图片转视频功能**
- **缺少多版本结果展示**

---

## 二、详细功能差异

### 2.1 手动模式(高精度模式)

#### Vue系统实现
```vue
// 支持两种模式切换
activeMode: 'normal' | 'highPrecision'

// 手动模式功能:
- Canvas画布操作
- 产品图片拖拽移动
- Shift+拖动旋转
- Alt+拖动缩放
- 产品位置坐标计算
- 背景去除功能
- 重置位置功能
```

#### React系统
```tsx
// 仅支持自动模式
// 缺少手动模式相关代码
```

**缺失的具体功能:**
1. Canvas画布组件
2. 图片变换操作(拖拽、旋转、缩放)
3. 位置坐标计算和归一化
4. 背景去除API调用
5. 重置变换功能
6. 操作提示说明

---

### 2.2 图片转视频功能

#### Vue系统实现
```vue
// product-replace.vue 中实现
- image2VideoSubmit: 提交图片转视频任务
- image2VideoQuery: 查询视频生成状态
- v2image2VideoSubmit: V2版本提交
- v2image2VideoQuery: V2版本查询
- 支持文本转语音
- 支持音频上传
- 音色选择
- 字幕样式选择
```

#### React系统
```tsx
// 完全缺失
// 没有图片转视频相关代码
```

**缺失的具体功能:**
1. 图片转视频任务提交
2. 视频生成状态查询
3. 文本转语音集成
4. 音频上传集成
5. 音色选择组件
6. 字幕样式选择组件
7. 视频预览功能

---

### 2.3 多版本结果展示

#### Vue系统实现
```vue
// 支持多个生成结果
productReplaceResult: [
  { key: 'xxx', url: 'xxx' },
  { key: 'yyy', url: 'yyy' }
]
// 用户可以选择不同版本
```

#### React系统
```tsx
// 仅支持单张结果
previewImageUrl: string | null
// 没有多版本选择功能
```

---

### 2.4 背景去除功能

#### Vue系统实现
```vue
// 手动模式下自动调用背景去除
removeBackgroundSubmit: 提交背景去除任务
removeBackgroundQuery: 查询背景去除状态
// 轮询直到完成
```

#### React系统
```tsx
// 完全缺失
// 没有背景去除相关代码
```

---

### 2.5 API接口差异

#### Vue系统使用的API
```typescript
// 产品数字人相关
productAvatarQuery: 获取数字人列表
productAvatarCategoryQuery: 获取分类列表
imageReplaceSubmit: 提交图片替换任务(V1)
v2imageReplaceSubmit: 提交图片替换任务(V2)
imageReplaceQuery: 查询任务状态(V1)
v2imageReplaceQuery: 查询任务状态(V2)

// 背景去除
removeBackgroundSubmit: 提交背景去除
removeBackgroundQuery: 查询背景去除状态

// 图片转视频
image2VideoSubmit: 提交图片转视频
image2VideoQuery: 查询视频生成状态
v2image2VideoSubmit: V2版本提交
v2image2VideoQuery: V2版本查询
```

#### React系统使用的API
```typescript
// 仅部分实现
getProductAvatarList: 获取数字人列表
getProductAvatarCategories: 获取分类列表
submitImageReplaceTask: 提交图片替换任务
queryImageReplaceTask: 查询任务状态

// 缺失的API
// 背景去除相关API
// 图片转视频相关API
// V2版本API
```

---

## 三、页面路由差异

### Vue系统路由
```
/creationCenter/creative/avc?pageMode=synthesis
  → 主页面(pa-index.vue)

/creationCenter/productReplace?taskId=xxx
  → 结果页面(product-replace.vue)

/creationCenter/productReplace?taskId=xxx&v2=true
  → V2版本结果页面
```

### React系统路由
```
/create?tool=digitalHuman
  → 主页面(DigitalHumanPage.tsx)
  → 切换到product标签页(DigitalHumanProduct.tsx)

// 没有独立的结果展示页面
```

---

## 四、UI/UX差异

### Vue系统
- 三栏布局(左侧模板、中间配置、右侧预览)
- 手动模式有详细的操作提示
- 结果页面有完整的视频生成流程
- 支持多版本结果对比

### React系统
- 两栏布局(左侧模板、右侧配置和结果)
- 结果在主页面中展示
- 缺少操作提示
- 单版本结果展示

---

## 五、数据流差异

### Vue系统数据流
```
1. 主页面提交任务
   → 跳转到结果页面(/creationCenter/productReplace)
   → 结果页面轮询任务状态
   → 展示多版本结果
   → 选择结果进行图片转视频
   → 生成视频

2. 使用productAvatarStore缓存任务参数
```

### React系统数据流
```
1. 主页面提交任务
   → 主页面轮询任务状态
   → 主页面展示单张结果
   → 结束(没有图片转视频流程)

2. 没有使用store缓存任务参数
```

---

## 六、需要迁移的功能清单

### 高优先级(核心功能)
1. ✅ **手动模式(highPrecision模式)**
   - Canvas画布组件
   - 图片变换操作
   - 背景去除功能
   - 位置坐标计算

2. ✅ **图片转视频功能**
   - 图片转视频任务提交
   - 视频生成状态查询
   - 文本转语音集成
   - 音频上传集成
   - 音色选择
   - 字幕样式选择

3. ✅ **结果展示页面**
   - 独立的结果展示页面
   - 多版本结果展示
   - 图片预览功能
   - 重新生成功能

### 中优先级(增强功能)
4. ⚠️ **V2版本API支持**
   - v2imageReplaceSubmit
   - v2imageReplaceQuery
   - v2image2VideoSubmit
   - v2image2VideoQuery

5. ⚠️ **任务参数缓存**
   - 使用store缓存任务参数
   - 支持从结果页面返回继续编辑

### 低优先级(优化功能)
6. 💡 **UI/UX优化**
   - 操作提示说明
   - 多版本结果对比
   - 更好的进度显示

---

## 七、技术实现建议

### 7.1 手动模式实现
```tsx
// 需要创建组件
- MaskCanvas.tsx (已存在,需要检查是否满足需求)
- ProductCanvas.tsx (已存在,需要检查是否满足需求)

// 需要实现的功能
- 图片拖拽
- 图片旋转(Shift+拖动)
- 图片缩放(Alt+拖动)
- 坐标归一化计算
- 背景去除API集成
```

### 7.2 图片转视频实现
```tsx
// 需要创建页面
- ProductReplacePage.tsx (结果展示页面)

// 需要集成的组件
- VoiceModal (音色选择,已存在)
- CaptionModal (字幕选择,已存在)
- 文本转语音输入
- 音频上传组件

// 需要实现的API
- image2VideoSubmit
- image2VideoQuery
- v2image2VideoSubmit
- v2image2VideoQuery
```

### 7.3 路由配置
```tsx
// router/routes/local.tsx
{
  path: '/create/product-replace',
  component: ProductReplacePage,
  // ...
}
```

---

## 八、总结

### 功能完成度
- **Vue系统**: 100% (包含所有功能)
- **React系统**: 约60% (缺少手动模式和图片转视频)

### 主要缺失
1. 手动模式(高精度模式) - **核心功能缺失**
2. 图片转视频功能 - **核心功能缺失**
3. 独立的结果展示页面 - **用户体验缺失**
4. 多版本结果展示 - **功能缺失**

### 迁移建议
1. **优先迁移手动模式**,这是产品数字人的核心差异化功能
2. **其次迁移图片转视频**,这是完整的业务流程
3. **最后优化UI/UX**,提升用户体验

---

**文档生成时间**: 2025-01-XX  
**对比系统版本**: 
- Vue系统: web-Lab (最新)
- React系统: Nebula-Lab-React (当前)

