# Router 路由文档

本目录包含应用的路由配置和路由守卫逻辑。

## 文件结构

```
router/
├── index.tsx          # 路由主入口，创建路由实例
├── AuthGuard.tsx      # 路由认证守卫
└── routes/
    ├── core.tsx       # 核心路由配置（Layout、Home、Privacy）
    └── local.tsx      # 本地业务路由配置（Dashboard相关页面）
```

## 文件说明

### **index.tsx** - 路由主入口
- **功能**: 创建并导出 React Router 的路由实例
- **特性**:
  - 使用 `createHashRouter` 创建路由（Hash 模式）
  - 自动处理路由懒加载（Suspense）
  - 自动应用 AuthGuard（根据 meta.requiresAuth）
  - 合并 coreRoutes 和 localRoutes
  - 提供 `useAppOutletContext` Hook 用于获取路由上下文

### **AuthGuard.tsx** - 路由认证守卫
- **功能**: 保护需要认证的路由
- **特性**:
  - 检查用户 Token 和认证状态
  - 支持路由白名单（不需要登录的路由）
  - 白名单路由：
    - `/`
    - `/auth/login`
    - `/auth/register`
    - `/privacy`
  - 可配置的认证要求（通过 meta.requiresAuth）

- **类型定义**:
  - `RouteMeta`: 路由元数据接口
    - `title`: 路由标题
    - `icon`: 图标
    - `hideInMenu`: 是否在菜单中隐藏
    - `roles`: 允许的角色列表
    - `requiresAuth`: 是否需要登录
  - `AppRouteObject`: 扩展的路由对象类型

### **routes/core.tsx** - 核心路由
- **功能**: 定义应用的核心路由结构
- **路由配置**:
  - `/` (Layout 组件)
    - `/` (index): Home 页面 - 首页
    - `/privacy`: Privacy 页面 - 隐私政策页
  - `*`: 404 重定向到首页

- **特点**:
  - 使用 Layout 组件作为根布局
  - Home 和 Privacy 都不需要认证

### **routes/local.tsx** - 业务路由
- **功能**: 定义业务功能相关的路由
- **路由配置**:
  - DashboardLayout 作为父布局
    - `/create`: 创作页面 - AI 创作工具集合
    - `/assets`: 素材管理页面 - 素材库管理
    - `/chat`: 聊天页面 - AI 对话体验
    - `/keys`: API 密钥页面 - API 密钥管理
    - `/models`: 模型广场页面 - AI 模型浏览
    - `/expenses`: 消费记录页面 - 消费明细
    - `/pricing`: 价格页面 - 价格方案
    - `/profile`: 个人中心页面 - 用户信息

- **特点**:
  - 所有路由都需要认证（requiresAuth: true）
  - 使用 DashboardLayout 作为布局（包含侧边栏）
  - 所有组件都使用懒加载（React.lazy）

## 路由结构

```
/ (Layout)
├── / (Home) - 首页
├── /privacy - 隐私政策
└── DashboardLayout
    ├── /create - 创作中心
    ├── /assets - 素材管理
    ├── /chat - AI 对话
    ├── /keys - API 密钥
    ├── /models - 模型广场
    ├── /expenses - 消费记录
    ├── /pricing - 价格方案
    └── /profile - 个人中心
```

## 使用方式

### 在组件中获取路由上下文
```typescript
import { useAppOutletContext } from '@/router';

function MyComponent() {
  const { t, handleNavClick, onSignIn } = useAppOutletContext();
  // 使用上下文数据
}
```

### 添加新路由
1. 在 `routes/local.tsx` 中添加路由配置
2. 懒加载对应的页面组件
3. 设置适当的 meta 信息（title, icon, requiresAuth）

### 路由守卫
路由守卫会自动检查 `meta.requiresAuth`，如果为 `true` 且用户未登录，会阻止访问（具体行为由 AuthGuard 实现）。

## 注意事项

1. **路由模式**: 使用 Hash 模式（`createHashRouter`），URL 格式为 `/#/path`
2. **懒加载**: 所有页面组件都使用 `React.lazy` 进行代码分割
3. **认证**: 需要认证的路由必须设置 `meta.requiresAuth: true`
4. **404**: 未匹配的路由会自动重定向到首页
5. **上下文传递**: Layout 通过 Outlet context 向下传递翻译、导航等数据

