# Services 服务层文档

本目录包含所有与后端 API 交互的服务层代码。每个服务文件对应一个业务模块，封装了相关的 API 调用逻辑。

## 服务文件列表

### 认证相关
- **authService.ts** - 认证服务
  - 用户登录（账号密码、手机号验证码）
  - 用户注册
  - 发送短信验证码
  - 发送邮件验证码
  - Token 刷新

### 用户相关
- **profileService.ts** - 用户资料服务
  - 获取用户信息
  - 更新用户资料
  - 修改密码
  - 头像上传

- **userInviteService.ts** - 用户邀请服务
  - 发送邀请
  - 获取邀请列表
  - 处理邀请

### 团队相关
- **teamService.ts** - 团队服务
  - 创建团队
  - 获取团队列表
  - 更新团队信息
  - 删除团队
  - 团队成员管理

- **teamUserService.ts** - 团队成员服务
  - 添加团队成员
  - 移除团队成员
  - 更新成员角色
  - 获取成员列表

- **teamRoleService.ts** - 团队角色服务
  - 获取角色列表
  - 创建角色
  - 更新角色权限

### 素材管理
- **assetsService.ts** - 素材服务
  - 获取素材列表
  - 添加素材
  - 更新素材信息
  - 删除素材
  - 素材分类管理
  - 素材搜索

- **uploadService.ts** - 文件上传服务
  - 上传文件到 OSS
  - 获取上传凭证
  - 文件上传进度

### AI 功能服务

#### 对话与聊天
- **chatService.ts** - 聊天服务
  - 发送消息
  - 获取对话历史
  - 创建新对话
  - 删除对话
  - 流式响应处理

- **aiToolService.ts** - AI 工具服务
  - 获取 AI 工具列表
  - 调用 AI 工具
  - 工具执行结果

#### 图像生成
- **textToImageService.ts** - 文生图服务
  - 文本生成图片
  - 获取生成任务状态
  - 下载生成的图片

- **imageGenerateService.ts** - 图像生成服务
  - 图像生成任务创建
  - 任务状态查询
  - 结果获取

#### 视频生成
- **imageToVideoService.ts** - 图生视频服务
  - 图片生成视频
  - 任务状态查询
  - 视频下载

- **videoGenerateService.ts** - 视频生成服务
  - 视频生成任务
  - 任务管理
  - 视频处理

- **viralVideoService.ts** - 爆款视频服务
  - 商品图片分析
  - 脚本生成
  - 分镜生成
  - 视频合成
  - 任务状态管理

#### 其他 AI 功能
- **styleTransferService.ts** - 风格迁移服务
  - 图片风格迁移
  - 风格模板管理
  - 任务处理

- **avatarService.ts** - 数字人服务
  - 数字人创建
  - 数字人列表
  - 数字人驱动
  - 视频生成
  - 上传凭证获取

### 模型管理
- **modelService.ts** - 模型服务
  - 获取模型列表
  - 模型详情
  - 模型使用统计
  - 模型配置

- **modelsService.ts** - 模型广场服务
  - 浏览模型
  - 模型搜索
  - 模型分类
  - 模型收藏

### 模板服务
- **templateService.ts** - 模板服务
  - 获取模板列表
  - 模板详情
  - 使用模板
  - 模板分类

### 渠道服务
- **channelService.ts** - 渠道服务
  - 渠道管理
  - 渠道配置
  - 渠道统计

### 订单与支付
- **orderService.ts** - 订单服务
  - 创建订单
  - 订单列表
  - 订单详情
  - 订单支付
  - 订单状态查询

- **pricingService.ts** - 价格服务
  - 获取价格方案
  - 价格计算
  - 套餐信息

- **expenseService.ts** - 消费记录服务
  - 获取消费记录
  - 消费统计
  - 账单详情
  - 导出账单

### API 密钥
- **keyService.ts** - API 密钥服务
  - 创建 API 密钥
  - 获取密钥列表
  - 更新密钥
  - 删除密钥
  - 密钥使用统计

### 通知服务
- **notificationService.ts** - 通知服务
  - 获取通知列表
  - 标记已读
  - 删除通知
  - 通知设置

### 配额服务
- **quotaService.ts** - 配额服务
  - 获取配额信息
  - 配额使用情况
  - 配额充值

## 服务使用规范

### 统一使用 request 客户端
所有服务都使用 `lib/request.ts` 中导出的请求客户端：

```typescript
import { request } from '@/lib/request';
```

### 标准服务结构
每个服务文件通常遵循以下结构：

```typescript
// 类型定义
export interface ServiceType {
  // ...
}

// 服务对象
export const serviceName = {
  // 方法1
  method1: async (params: Params): Promise<Response> => {
    return await request.post('/api/endpoint', params);
  },
  
  // 方法2
  method2: async (id: string): Promise<Response> => {
    return await request.get(`/api/endpoint/${id}`);
  }
};
```

### 错误处理
服务层不直接处理错误，而是将错误向上抛出，由调用方处理：

```typescript
try {
  const data = await assetsService.getList();
} catch (error) {
  // 在组件中处理错误
  console.error('获取素材列表失败:', error);
}
```

### 类型定义
每个服务都应该导出相关的 TypeScript 类型定义，便于在组件中使用：

```typescript
// 在组件中使用
import { assetsService, AssetsForm } from '@/services/assetsService';
```

## 注意事项

1. **API 路径**: 所有 API 路径都是相对于 `API_BASE_URL` 的
2. **认证**: 大部分 API 需要认证，Token 会自动通过 request 客户端注入
3. **响应格式**: 遵循 Ruoyi 标准格式 `{ code, msg, data }`，request 会自动提取 `data`
4. **加密**: 敏感数据可通过设置 `encrypt: true` 启用加密传输
5. **文件上传**: 使用 `request.upload()` 方法或直接使用 FormData
6. **分页**: 分页响应格式为 `{ rows, total }`，会自动转换

## 添加新服务

1. 在 `services/` 目录下创建新的服务文件
2. 定义相关的 TypeScript 类型
3. 导出服务对象，包含所有相关方法
4. 使用统一的 request 客户端进行 API 调用
5. 在组件中导入并使用

